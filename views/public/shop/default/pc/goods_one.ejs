<div class="slidmenu">
<% include common_top.ejs %>
<% include common_banner.ejs %>

</div>
<div id="schedule">
<div class="schedule_h">
<span class="schedule_hf">当前位置:</span>
<div class="schedule_hs"><a href="/">首页</a>  > <a href="/goods/<%=goods.id%>" class="color_y">产品详情</a></div>
</div>
</div>

<div class="schedule_im">
<div class="scrolltabm">
<div class="ban-barmlm">
<ul class="ulBigPicm">
<%if(goods.images){goods.images.forEach(function(o){%>
  <li>
  <a href="javascript:;"><img src="<%=o.imgurl%>?type=m" width="420" height="420"/></a>
  </li>
  <%});}%>
  </ul>
  <div id="fbigimg">
  <img src="" style="width:420px;height:420px" id="fbigimg_src"/>
  </div>
  </div>
  <div class="dSmallPicBoxm">
  <div class="dSmallPicm">
  <ul class="ulSmallPicm" style="width:2646px;left:0px" rel="stop">
  <%
  var img_i=0;
  if(goods.images){goods.images.forEach(function(o){%>
    <li <%=img_i==0?'class=liSelectedm':''%>>
    <a href="javascript:;"><img src="<%=o.imgurl%>?type=m" width="69" height="69"/></a>
    </li>
    <%
    img_i++;
  });}%>


  </ul>
  </div>
  <span id="sLeftBtnBm" class="sLeftBtnBm"></span>
  <span id="sRightBtnBm" class="sRightBtnBm"></span>
  </div>
  </div>
  <%
  var specObj = [];
  var specHas = [];
  if(goods.is_spec){
    goods.spec.forEach(function(j){
      j.forEach(function(y){
        specObj.push(j[0]['spec_name']+':'+y.spec_value_name);
      })
    });
    for(var i in products){
      specHas.push(i);
    }
  }
  %>
  <%
  //计算会员价
  var lv=goods.lvprice;
  var hyprice=0;
  var is_lv=false;//是否启用会员价
  var hyname='';
  var shop_p='';
  var shop_m='';
  if(lv&&lv.member_lv&&lv.member_lv.disabled==false){
    is_lv=true;
    hyname=lv.member_lv.name;
    if(lv.product_lv&&lv.product_lv.price>0){
      hyprice=lv.product_lv.price;
    }else {
      hyprice = goods.price>100?Math.ceil(goods.price * lv.member_lv.dis_count / 100):goods.price;
    }
  }

  %>

  <div style="display: none;" <%if(goods&&!goods.is_spec&&ShopConfig.list_quick_buy){%>class="top-float-menu-placeholder"<%}%>>
  <div class="top-float-menu-panel">
  <div class="top-float-menu">
  <ul>
  <span class="title"><img id="thumblist" src="<%=goods.imgurl||''%>?type=s" width="70" height="70" style="margin-top: 5px;">
  <%=goods.name||''%></span>
  <div class="top-float-menu-right">
  <span class="jia_gea" style="padding-right: 30px;">￥<%=hyprice>0?StringUtil.setPrice(hyprice):StringUtil.setPrice(goods.price)%></span>
  <span class="jiarua"><input onclick="addToCarShop($('#thumblist'),'<%=goods.id%>','')"  type="button" value="加入购物车"></span>
  </div>
  </ul>
  </div>
  </div>
  </div>

  <ul class="schedule_hdm">
  <li class="schedule_hd1m">
  <span class="schedule_hd1am"><%=goods.name||''%></span>
  <span class="schedule_hd1sm"><%=goods.info||''%></span>
  </li>
  <%

  %>
  <div class="" id="bgcc" style="position:relative">
  <li class="schedule_hd2m cf clear">
  <div class="guige_add">
  <span class="jia_ge">销售价：</span><i class="jia_gea" id="xsj">¥<%=StringUtil.setPrice(goods.price)%></i>
  <span class="jia_scj"><s id="scj">￥<%=StringUtil.setPrice(goods.priceMarket)%></s></span></div>

  </li>
  <%if(is_lv){%>
    <li class="schedule_hd4m cf clear">
    <div class="guige_add">
    <span class="jia_ge">会员价：</span><i class="jia_gea" id="hyj">¥<%=StringUtil.setPrice(hyprice)%></i>(您的会员分组:<%=hyname||''%>)</div>

    </li>
    <%}%>
    <%if(ShopConfig.freight_disabled && ShopConfig.freight_type == 'weight'){%>
      <li class="schedule_hd4m cf clear">
      <div class="guige_add"><span class="jia_ge">重&nbsp;&nbsp;&nbsp;量：</span><%=goods.weight||'0'%>克</div>
      </li>
      <%}%>
      <%if(goods.is_spec){ var speccheck = [];%>
        <%
        var specvalueurl = {};
        goods.speclist.forEach(function(es){
          es.values.forEach(function(er){
            specvalueurl[es.name+':'+er.spec_value] = er.spec_picurl;
          })
        });
        %>


        <span id="bgcl" onclick="bgcc_close()">×</span>
        <%goods.spec.forEach(function(e){var speccheckone = [];var speconevalue = '';%>
        <li class="t_size cf2"><span class="t_sizea"><%=e[0]['spec_name']%>：</span>
        <span class="t_sizem">
        <%e.forEach(function(o){
          var specname = e[0]['spec_name'] + ':' + o.spec_value_name;
          var specstrname = goods.products[0]['spec'];
          if(specstrname.indexOf(specname) > -1){
            speconevalue = specname;
          }
          speccheckone.push(specname);
          if(o.spec_value_imgurl == null){
            o.spec_value_imgurl = specvalueurl[specname];
          }
          %>
          <span class="specselect <%if(speconevalue == specname){%>t_sizebon<%}else{%>t_sizeb<%}%>" name="<%=specname%>" data-id="<%=o.spec_value_id%>" data-specvalue="<%=specname%>" data-sid="<%=o.spec_id%>" data-value="<%=o.spec_value_name%>" data-checkclick="2" data-imgurl="<%=o.spec_value_imgurl || ''%>">
          <%if(o.spec_value_imgurl && o.spec_value_imgurl != null){%><img src="<%=o.spec_value_imgurl%>" class="t_sizee"/><%}%>
          <%=o.spec_value_name%><img src="<%=CssPath%>/pc/img/icon/duiga.png" class="t_sized"/></span>
          <%})%>
          <input type="hidden" id="" value="<%=speconevalue%>" data-speclist="<%-speccheckone%>" class="spec_store" data-spec='<%=e[0]['spec_name']%>' data-idstr="">
          </span>
          </li>
          <%
          speccheck.push(speccheckone);
        })%>
        <li style="font-size:14px;color:#ff0000;font-weight:bold;margin:0px 20px 5px;letter-spacing:1px;text-indent:60px;" id="bgww">请选择您要的商品信息！</li>
        <script>
        function bgcc_close(){
          $('#bgcc').removeClass('bgcc');
          $('#bgww').hide();
          $('#bgcl').hide();
        }
        </script>
        </div>
        <li style="height:8px"></li>
        <%
      }%>

      <style>
      .addr_add_c span{display: none}
      </style>
      <li class="song cf2">
      <span class="song_l">配送至：</span>
      <div class="song_r"><span class="song_ra" style="background:#F4F4F4;z-index:2" id="song_d">选择具体范围<img src="<%=CssPath%>/pc/img/icon/song_x.png" class="song_i"/></span>
      <div class="slideTxtBox c_hide" style="z-index:1">
      <div class="hd cf2">
      <span class="arrow"><a class="next"></a><a class="prev"></a></span>
      <div class="addr_add_c">
      <span id="province_chose"></span>
      <span id="city_chose"></span>
      <span id="county_chose"></span>
      </div>
      </div>
      <div class="bd">
      <ul class="song_bot" id="s_province_s">
      </ul>
      <ul class="song_bot" id="s_city_s" style="display: none">
      </ul>
      <ul class="song_bot" id="s_county_s" style="display: none">
      </ul>
      </div>
      </div></div>
      </li>

      <li class="schedulehd4">
      <div class="schedulehd4_h">选择数量:</div>
      <div class="schedulehd4z"><a id="buy_sub" href="javascript:void(0);" title="减1" class="schedulehd4_a">—</a>
      <input id="buy_num" type="text" class="schedulehd4_s" value="1" maxlength="4" title="请输入购买量">
      <a id="buy_add" href="javascript:void(0);" title="加1" class="schedulehd4_a">+</a>
      <span class="schedulehd4_d" id="kcs">(库存<%=goods.products[0].stock||0%><%=goods.unit||''%>)</span>

      </div>
      </li>

      <li class="schedule_hd6m">
      <div class="schedule_hd6n">
      <%if(goods.is_spec){%>
        <input onclick="specbuynow()" type="button" value="立即购买" class="schedulehd4_g">
        <input onclick="specincart()" type="button" value="加入购物车" class="schedulehd4_f">
        <%}else{%>
          <input id="cart-btn" type="button" value="立即购买" class="schedulehd4_g">
          <input onclick="addToCarShop($('#thumblist'),'<%=goods.id%>','0',$('#buy_num').val())" type="button" value="加入购物车" class="schedulehd4_f">
          <%}%>
          </div>
          </li>
          </ul>
          </div>
          <div class="s_pinjia cf">
          <div class="hot_sell">
          <div class="hot_sella"><span>热销商品</span></div>
          <%hotGoodsList.data.forEach(function(ho){%>
            <dl class="hot_sells">
            <a href="/goods/<%=ho.id%>" target="_blank">
            <dt><img src="<%=ho.imgurl%>"></dt>
            <dd><%=ho.name%><p style="font-size: 14px;">￥<%=StringUtil.setPrice(ho.price)%> <s style="color: #ccc;font-size: 9px;">￥<%=StringUtil.setPrice(ho.priceMarket)%></s></p>
            </dd>
            </a>
            </dl>
            <%});%>
            </div>
            <div class="fr">
            <div id="s_detail">
            <ul class="s_detail">
            <a id="tab1" href="javascript:void(0);" class="s_details s_detaila">
            <li>详情</li>
            </a>
            <a id="tab2" href="javascript:void(0);" class="s_details">
            <li>评价</li>
            </a>
            <a id="tab3" href="javascript:void(0);" class="s_details">
            <li>咨询</li>
            </a>
            </ul>
            </div>

            <div class="s_detaild cf clear">
            <div id="xq" class="ml20 mt10 s_detaildf">
            <%if(goods.prop&&goods.prop.length>0){%>
              <div class="s_detaildf_sx">
              <p class="s_detaildf_sxa">产品参数：</p>
              <%goods.prop.forEach(function(p){%>
                <li><%=p.name%>: <%=p.value%></li>
                <%});%>

                </div>
                <%}%>
                <div style="height: 20px;"></div>
                <div>
                <%-goods.note||''%>
                </div>
                </div>
                <div id="pj" class="cf clear" style="display: none">
                <div class="tab3">
                <span style="width:160px;line-height:58px;display:inline-block;text-align:center;"><span
                style="font-size:14px;color:#333;">好评率:</span><i id="goodRate" style="font-size:24px;color:#e4003c;">100%</i></span>
                <a href="javascript:;" data-id="0" class="on3">全部(<span id="c0">1</span>)</a>
                <a href="javascript:;" data-id="3">好评(<span id="c3">1</span>)</a>
                <a href="javascript:;" data-id="2">中评(<span id="c2">1</span>)</a>
                <a href="javascript:;" data-id="1">差评(<span id="c1">1</span>)</a>
                </div>
                <div id="pj_list" style="text-align: center">


                </div>
                <div id="page1" class="s_page cf clear tcdPageCode"></div>
                </div>
                <div id="zx" class="cf clear" style="display: none">
                <div>
                <ul class="zixun">
                <li class="z_zixun">
                <span class="z_zixuna">
                <input type="button" value="我要咨询" id="goCon">
                </span>
                </li>
                <li class="z_zixunf" style="display:none" id="showCon">
                <span class="z_zixunf1">我要咨询</span>
                <span class="z_zixunf3" style="margin-top: 1rem">
                <textarea placeholder="欢迎发表咨询，最多400字" id="c_content" maxlength="400" onKeyDown="LimitTextArea(this)" onKeyUp="LimitTextArea(this)" onkeypress="LimitTextArea(this)"></textarea>
                <span id="nww">0</span>/400
                </span>
                <span class="z_zixunf4">联系方式：<input type="text" id="c_contact" maxlength="40"><i>可以是电话、email、qq等</i></span>
                <span class="z_zixunf5"><a href="javascript:;" onclick="createConsult('<%=goods.id%>')">提交咨询</a></span>
                </li>
                </ul>
                </div>
                <div id="zx_list" style="text-align: center">

                </div>
                <div id="page2" class="s_page cf clear tcdPageCode"></div>
                </div>
                </div>
                </div>
                </div>
                <div id="tip" style="display:none">
                <div class="oc_pro_bg"></div>
                <div class="oc_pro_m">
                <span class="oc_pro_b">提示</span>
                <span class="oc_pro_a"></span>
                <span class="oc_pro_cl"><input value="确定" type="button" class="oc_pro"/><input type="button" value="取消" class="oc_pro1"/></span>
                </div>
                </div>
                <script>
                var goodsid=<%=goods.id%>;
                var productid=<%=goods.products[0].id%>;
                var imgPath2 = "<%=CssPath%>/pc/img/icon/detail2.jpg";
                var imgPath3 = "<%=CssPath%>/pc/img/icon/detail3.jpg";
                var isLvP = false;
                var unit = "<%=goods.unit||''%>";
                <%if(goods.is_spec){%>
                  var specObj = <%-JSON.stringify(specObj)%>;
                  var specHas = <%-JSON.stringify(specHas)%>;
                  var specList = <%-JSON.stringify(products)%>;
                  var specLength = <%-goods.spec.length%>;
                  var specchecklist = <%-JSON.stringify(speccheck)%>;
                  <%}%>
                  <%if(lv&&lv.member_lv&&lv.member_lv.disabled==false){%>
                    isLvP = true;
                    var lvid = <%=lv.member_lv.id%>;
                    var dis_count = <%=lv.member_lv.dis_count%>;
                    <%}%>
                    </script>
                    <%if(goods.is_spec){%>
                      <script>
                      function specincart(){
                        var specchoses = returnSelect();
                        if(specchoses.length < specLength){
                          $('#bgcc').addClass('bgcc');
                          $('#bgww').show();
                          $('#bgcl').show();
                        }else{
                          for(var s in specList){
                            var hl = 0;
                            $.each(specchoses,function(m,n){
                              if(s.indexOf(n) > -1)hl++;
                            });
                            if(hl == specLength){
                              var xxid = specList[s]['id'];
                              break;
                            }
                          }
                          //specStr = specStr.substring(0,specStr.length-1);
                          var productid = xxid;
                          addToCarShop($('#thumblist'),goodsid,productid,$('#buy_num').val());
                        }
                      };
                      function specbuynow(){
                        var specchoses = returnSelect();
                        if(specchoses.length < specLength){
                          $('#bgcc').addClass('bgcc');
                          $('#bgww').show();
                          $('#bgcl').show();
                        }else{
                          for(var s in specList){
                            var hl = 0;
                            $.each(specchoses,function(m,n){
                              if(s.indexOf(n) > -1)hl++;
                            });
                            if(hl == specLength){
                              var xxid = specList[s]['id'];
                              break;
                            }
                          }
                          //specStr = specStr.substring(0,specStr.length-1);
                          var productid = xxid;
                          $.ajax({
                            type : "POST",
                            url : "/public/shop/pc/shopcart/save?goodsId="+goodsid+"&productId="+productid+"&num="+$("#buy_num").val(),
                            data : {
                              list:[]
                            },
                            dataType : "json",
                            success : function(data) {
                              if(data.code==0){
                                window.location.href='/shopcart/buy';
                              }else if(data.code==1){
                                window.location.href='/login?r=/goods/'+goodsid;
                              }else if(data.code==3){
                                $("#tip .oc_pro_a").html(data.msg);
                                $("#tip").show();
                                $("#tip input[type=button]").eq(0).unbind("click").on("click",function(){
                                  $("#tip").hide();
                                });
                                $("#tip input[type=button]").eq(1).unbind("click").on("click",function(){
                                  $("#tip").hide();
                                });
                              }
                            }
                          });
                        }
                      }
                      </script>
                      <script src="<%=TplPath%>/js_pc/spec.js"></script>
                      <%}%>
                      <script src="<%=TplPath%>/js_pc/goods.js"></script>
                      <% include common_buttom.ejs %>
