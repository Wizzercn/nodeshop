<header class="header navbar bg-white shadow">
  <div class="btn-group tool-button">
    <a class="btn btn-primary navbar-btn" href="/private/shop/goods/goods" data-pjax><i class="ti-angle-left"></i> 返回</a>
  </div>
  <div class="pull-right">
    <div class="btn-group tool-button">
      <button class="btn btn-primary navbar-btn" type="button" id="save"> 保存</button>
    </div>
  </div>
</header>

<div class="content-wrap">
  <div class="wrapper" style="min-height:500px;">
      <form id="addForm" role="form" class="form-horizontal parsley-form" data-parsley-validate
            action="/private/shop/goods/goods/addDo" method="post">
        <div class="box-tab tabs-left">
          <ul class="nav nav-tabs">
            <li class="active"><a href="#base" data-toggle="tab">基本信息</a>
            </li>
            <li id="kzsx_tab" class="" style="display: none"><a href="#kzsx" data-toggle="tab">扩展属性</a>
            </li>
            <li class=""><a href="#inf" data-toggle="tab">详细介绍</a>
            </li>
            <li class=""><a href="#seo" data-toggle="tab">SEO设置</a>
            </li>
          </ul>
          <div class="tab-content text-center">
            <div class="tab-pane fade active in" id="base">
              <div class="row mb10">
                <div class="col-lg-12">
                  <div class="form-group has-feedback">
                    <label for="parentId" class="col-sm-2 control-label">商品分类</label>

                    <div class="col-sm-8">
                      <div class="input-group">
                        <input id="parentId" type="text" class="form-control" placeholder="请选择商品分类" disabled
                               value="<%=typeof parentUnit!='undefined'?parentUnit.name:'' %>"/>

			                             		<span class="input-group-btn">
			                             			<button type="button" class="btn btn-primary" data-toggle="modal"
                                                data-target="#dialogSelectParentUnit"><i class="ti-plus"></i>选择
                                        </button>
			                             		</span>
                      </div>
                      <input type="hidden" name="parentId" value="<%=typeof parentUnit!='undefined'?parentUnit.id:0 %>">
                    </div>
                  </div>
                  <div class="form-group">
                    <label for="typeid" class="col-sm-2 control-label">商品类型</label>

                    <div class="col-sm-8">
                      <select id="typeid" name="typeid" class="form-control">
                        <option value="0">通用商品</option>
                        <%if(typelist){
                        typelist.forEach(function(o){
                        %>
                        <option value="<%=o.id%>"><%=o.name%></option>
                        <%
                        });
                        }%>
                      </select>
                    </div>
                  </div>
                  <div class="form-group">
                    <label for="name" class="col-sm-2 control-label">商品名称</label>

                    <div class="col-sm-8">
                      <input type="text" id="name" class="form-control" name="name" data-parsley-required="true"
                             placeholder="商品名称">
                    </div>
                  </div>
                  <div class="form-group">
                    <label for="bn" class="col-sm-2 control-label">商品编号</label>

                    <div class="col-sm-8">
                      <input type="text" id="bn" class="form-control" name="bn" data-parsley-required="true"
                             placeholder="商品编号(不填则自动生成)">
                    </div>
                  </div>
                  <div class="form-group">
                    <label for="bn" class="col-sm-2 control-label">品牌</label>

                    <div class="col-sm-8">
                      <select id="brandid" name="brandid" class="form-control">
                        <option value="0">  </option>
                        <%if(brandlist){
                        brandlist.forEach(function(o){
                        %>
                        <option value="<%=o.id%>"><%=o.name%></option>
                        <%
                        });
                        }%>
                      </select>
                    </div>
                  </div>
                  <div class="form-group">
                    <label for="bn" class="col-sm-2 control-label">商品简介</label>

                    <div class="col-sm-8">
                      <textarea type="textarea" placeholder="简短的商品介绍,请不要超过70个字" class="form-control"  name="info" style="resize:none;" cols="50" rows="3" maxlength="70" ></textarea>
                    </div>
                  </div>
                  <div class="form-group">
                    <label for="bn" class="col-sm-2 control-label">商品相册</label>

                    <div class="col-sm-8">

                    </div>
                  </div>
                  </div>
                </div>
            </div>
            <div class="tab-pane fade" id="kzsx">

            </div>
            <div class="tab-pane fade" id="inf">
              <div class="row mb10">
                <div class="col-lg-12" style="text-align:left">
                  <textarea id="note" name="note" style="width:100%;height:200px;"></textarea>
                </div>
              </div>
            </div>
            <div class="tab-pane fade" id="seo">
              <h1 class="text-muted bolder pb25 pt25">3</h1>
            </div>
          </div>
        </div>
        <div class="col-lg-3"></div>
      </form>

  </div>
</div>
<!-- 选择上级 -->
<div id="dialogSelectParentUnit" class="modal fade bs-modal-sm" tabindex="-1" role="dialog" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal" aria-hidden="true">×</button>
        <h4 class="modal-title">选择分类</h4>
      </div>
      <div class="modal-body">
        <div class="row">
          <div class="col-xs-12">
            <div id="jsTreeParentUnit" class="demo"></div>
          </div>
        </div>
      </div>
      <div class="modal-footer">
        <div class="pull-left">
          <button type="button" class="btn btn-success" data-dismiss="modal" onclick="selectFirstMenu()">不限分类</button>
        </div>
        <button type="button" class="btn btn-default" data-dismiss="modal">取 消</button>
        <button type="button" class="btn btn-primary" onclick="selectParentMenu()">确认选择</button>
      </div>
    </div>
  </div>
</div>
<script language="JavaScript">
  function initTreeView() {
    $("#jsTreeParentUnit").jstree({
      plugins: ["wholerow", "json_data"],
      core: {
        data: {
          dataType: "json",
          url: function (node) {
            return node.id === "#" ? "/private/shop/goods/class/tree" : "/private/shop/goods/class/tree?pid=" + node.id
          }
        },
        multiple: false
      }
    }).on("dblclick.jstree", function (node) {
      selectParentMenu();
    });
  }
  //选择父菜单
  function selectParentMenu() {
    var tree = $.jstree.reference("#jsTreeParentUnit");
    var node = tree.get_selected(true);
    var id=node[0].id;
    $("#addForm #parentId").val(node[0].text);
    $("#addForm input[name='parentId']").val(id);
    $("#dialogSelectParentUnit").modal("hide");
    
  }
  function selectFirstMenu() {
    $("#addForm #parentId").val("请选择商品分类");
    $("#addForm input[name='parentId']").val("");
    $("#dialogSelectParentUnit").modal("hide");
  }
  function clearFile() {
    $("#img").html("");
    $("#picurl").val("");
  }
  $(document).ready(function () {
    initTreeView();
    var ue = new baidu.editor.ui.Editor();
    ue.render('note');
    $('#file_upload').uploadifive({
      'auto': false,
      'multi': false,
      'width': '100%',
      'height': '35',
      'buttonText': '请选择图片',
      'fileType': 'image/*',
      'fileSizeLimit': 1024,
      'queueSizeLimit': 1,
      'formData': {},
      'queueID': 'queue',
      'uploadScript': '/open/fileupload/image',
      'onUploadComplete': function (file, data) {
        data = JSON.parse(data);
        if (data.code == 0) {
          Toast.success(data.msg);
          $("#img").html("<img src='" + data.path + "' style='width:150px;'>");
          $("#picurl").val(data.path);
        } else {
          clearFile();
          Toast.error(data.msg);
        }
      },
      'onDrop': function (file, fileDropCount) {
        clearFile();
      },
      'onClearQueue': function (queue) {
        clearFile();
      },
      'onCancel': function () {
        clearFile();
      }
    });
    $('#addForm').ajaxForm({
      dataType: 'json',
      beforeSubmit: function (arr, form, options) {
        form.find("button:submit").button("loading");
      },
      success: function (data, statusText, xhr, form) {
        if (data.code == 0) {
          Toast.success(data.msg);
          //刷新父级菜单
          form.resetForm();
        } else {
          Toast.error(data.msg);
        }
        form.find("button:submit").button("reset");
      }
    });
  });
</script>
